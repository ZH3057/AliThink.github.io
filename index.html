<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="热爱生活，乐于分享，时而沉默寡言，时而嘻哈扯淡的两面派">
<meta property="og:type" content="website">
<meta property="og:title" content="The  Force  Awakens
">
<meta property="og:url" content="http://alithink.com/index.html">
<meta property="og:site_name" content="The  Force  Awakens
">
<meta property="og:description" content="热爱生活，乐于分享，时而沉默寡言，时而嘻哈扯淡的两面派">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The  Force  Awakens
">
<meta name="twitter:description" content="热爱生活，乐于分享，时而沉默寡言，时而嘻哈扯淡的两面派">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6307056474677839000,
      author: 'AliThink'
    }
  };
</script>




  <link rel="canonical" href="http://alithink.com/"/>

  <title> The  Force  Awakens
 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?ddd5ea8fb6af25af228cf11a240076e8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">The  Force  Awakens
</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-desktop"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/01/CTMediator源码拾遗/" itemprop="url">
                  CTMediator源码拾遗
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-01T10:13:59+08:00" content="2016-09-01">
              2016-09-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读过的源码/" itemprop="url" rel="index">
                    <span itemprop="name">读过的源码</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/01/CTMediator源码拾遗/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/01/CTMediator源码拾遗/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>一句话简介：CTMediator为casa大神针对iOS组件化方案的一个架构实例。</p>
<p>架构详解: <a href="http://casatwy.com/iOS-Modulization.html" target="_blank" rel="external">传送门</a></p>
<p>Github: <a href="https://github.com/casatwy/CTMediator" target="_blank" rel="external">传送门</a></p>
<p>PS: 本拾遗系列文章只专注于代码以及工程层面知识点拾遗，架构层面作者文章已经进行了详细的讲解。</p>
</blockquote>
<h3 id="1-UIViewController常用分段"><a href="#1-UIViewController常用分段" class="headerlink" title="1. UIViewController常用分段"></a>1. UIViewController常用分段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#pragma mark - life cycle</div><div class="line">#pragma mark - UITableViewDelegate</div><div class="line">#pragma mark - CustomDelegate</div><div class="line">#pragma mark - event response</div><div class="line">#pragma mark - private methods</div><div class="line">#pragma mark - getters and setters</div></pre></td></tr></table></figure>
<p>这里有个争论就是关于是不是应该将属性实例的初始化放在getter中，这里个人倾向于casa的做法（放在getter中），所以贴一下相关的解释：</p>
<blockquote>
<p>我比较习惯一个对象的”私有”属性写在extension里面，然后这些属性的初始化全部放在getter里面做，在init和dealloc之外，是不会出现任何类似<code>_property</code>这样的写法的。</p>
<p>唐巧说他喜欢的做法是用<code>_property</code>这种，然后关于<code>_property</code>的初始化通过<code>[self setupProperty]</code>这种做法去做。从刚才上面的代码来看，就是要在viewDidLoad里面多调用一个setup方法而已，然后我推荐的方法就是不用多调一个setup方法，直接走getter。</p>
<p>嗯，怎么说呢，其实两种做法都能完成需求。但是从另一个角度看，苹果之所以选择让<code>[self getProperty]</code>和<code>self.property</code>可以互相通用，这种做法已经很明显地表达了苹果的倾向：<code>希望每个property都是通过getter方法来获得</code>。</p>
<p>早在2003年，Allen Holub就发了篇文章《<a href="http://www.javaworld.com/article/2073723/core-java/why-getter-and-setter-methods-are-evil.html" target="_blank" rel="external">Why getter and setter methods are evil</a>》，自此之后，业界就对此产生了各种争议，虽然是从Java开始说的，但是发展到后面各种语言也参与了进来。然后虽然现在关于这个问题讨论得少了，但是依旧属于没有定论的状态。setter的情况比较复杂，也不是我这一节的重点，我这边还是主要说getter。我们从objc的设计来看，苹果的设计者更加倾向于<code>getter is not evil</code>。</p>
<p>认为<code>getter is evil</code>的原因有非常之多，或大或小，随着争论的进行，大家慢慢就聚焦到这样的一个原因：<code>Getter和Setter提供了一个能让外部修改对象内部数据的方式，这是evil的，正常情况下，一个对象自己私有的变量应该是只有自己关心</code>。</p>
<p>然后我们回到iOS领域来，objc也同样面临了这样的问题，甚至更加严重：<code>objc并没有像Java那么严格的私有概念</code>。但在实际工作中，我们不太会去操作头文件里面没有的变量，这是从规范上就被禁止的。</p>
<p>认为<code>getter is not evil</code>的原因也可以聚焦到一个：<code>高度的封装性</code>。getter事实上是工厂方法，有了getter之后，业务逻辑可以更加专注于调用，而不必担心当前变量是否可用。我们可以想一下，假设一个ViewController有20个subview要加入view中，这20个subview的初始化代码是肯定逃不掉的，放在哪里比较好？放在哪里都比放在addsubview的地方好，我个人认为最好的地方还是放在getter里面，结合单例模式之后，代码会非常整齐，生产的地方和使用的地方得到了很好的区分。</p>
<p>所以放到iOS来说，我还是觉得使用getter会比较好，因为evil的地方在iOS这边基本都避免了，not evil的地方都能享受到，还是不错的。</p>
</blockquote>
<h3 id="2-应该在哪里配置View的位置？（-继续引用casa的原文）"><a href="#2-应该在哪里配置View的位置？（-继续引用casa的原文）" class="headerlink" title="2. 应该在哪里配置View的位置？（^_^继续引用casa的原文）"></a>2. 应该在哪里配置View的位置？（^_^继续引用casa的原文）</h3><ul>
<li><p>关于在哪儿写Constraints?</p>
<p>苹果在文档中指出，<code>updateViewConstraints</code>是用来做add constraints的地方。</p>
<p>但是在<a href="http://stackoverflow.com/questions/17497002/when-will-or-wont-updateviewconstraints-be-called-on-my-view-controller-for-m" target="_blank" rel="external">这里</a>有一个回答者说<code>updateViewConstraints</code>并不适合做添加Constraints的事情。</p>
<p>综合我自己和评论区各位关心这个问题的兄弟们的各种测试和各种文档，我现在觉得还是在<code>viewDidLoad</code>里面开一个layoutPageSubviews的方法，然后在这个里面创建Constraints并添加，会比较好。就是像下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line"></div><div class="line">    [self.view addSubview:self.firstView];</div><div class="line">    [self.view addSubview:self.secondView];</div><div class="line">    [self.view addSubview:self.thirdView];</div><div class="line"></div><div class="line">    [self layoutPageSubviews];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)layoutPageSubviews</div><div class="line">&#123;</div><div class="line">    [self.view addConstraints:xxxConstraints];</div><div class="line">    [self.view addConstraints:yyyConstraints];</div><div class="line">    [self.view addConstraints:zzzConstraints];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>生命周期方法选择</p>
<p>其实在viewWillAppear这里改变UI元素不是很可靠，Autolayout发生在viewWillAppear之后，严格来说这里通常不做视图位置的修改，而用来更新Form数据。改变位置可以放在viewWilllayoutSubview或者didLayoutSubview里，而且在viewDidLayoutSubview确定UI位置关系之后设置autoLayout比较稳妥。另外，viewWillAppear在每次页面即将显示都会调用，viewWillLayoutSubviews虽然在lifeCycle里调用顺序在viewWillAppear之后，但是只有在页面元素需要调整时才会调用，避免了Constraints的重复添加。</p>
</li>
</ul>
<h3 id="3-TableView-didSelect习惯"><a href="#3-TableView-didSelect习惯" class="headerlink" title="3. TableView didSelect习惯"></a>3. TableView didSelect习惯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 选择的开始先取消选择状态</div><div class="line">[tableView deselectRowAtIndexPath:indexPath animated:YES]</div></pre></td></tr></table></figure>
<h4 id="4-URL相关api"><a href="#4-URL相关api" class="headerlink" title="4. URL相关api"></a>4. URL相关api</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">NSMutableDictionary *params = [[NSMutableDictionary alloc] init];</div><div class="line"></div><div class="line">// 1. query: key1=value1&amp;key2=value2</div><div class="line">NSString *urlString = [url query];</div><div class="line"></div><div class="line">// 2. 解析参数</div><div class="line">for (NSString *param in [urlString componentsSeparatedByString:@&quot;&amp;&quot;]) &#123;</div><div class="line">    NSArray *elts = [param componentsSeparatedByString:@&quot;=&quot;];</div><div class="line">    if([elts count] &lt; 2) continue;</div><div class="line">    [params setObject:[elts lastObject] forKey:[elts firstObject]];</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 3. path: /index.html</div><div class="line">NSString *actionName = [url.path stringByReplacingOccurrencesOfString:@&quot;/&quot; withString:@&quot;&quot;];</div><div class="line">if ([actionName hasPrefix:@&quot;native&quot;]) &#123;</div><div class="line">    return @(NO);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-忽略不必要的警告⚠️"><a href="#5-忽略不必要的警告⚠️" class="headerlink" title="5. 忽略不必要的警告⚠️"></a>5. 忽略不必要的警告⚠️</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot;</div><div class="line">        return [target performSelector:action withObject:params];</div><div class="line">#pragma clang diagnostic pop</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/16/《函数式Swift》读书拾遗/" itemprop="url">
                  《函数式Swift》读书拾遗
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-16T11:18:26+08:00" content="2016-08-16">
              2016-08-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读过的书/" itemprop="url" rel="index">
                    <span itemprop="name">读过的书</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/16/《函数式Swift》读书拾遗/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/16/《函数式Swift》读书拾遗/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>设计良好的Swift函数式程序应该具有的一些特质：</p>
<ul>
<li>模块化</li>
<li>对可变状态的谨慎处理</li>
<li>类型</li>
</ul>
<blockquote>
<p>避免使用程序状态和可变对象，是降低程序复杂度的有效方式之一，而这也正是函数式编程的精髓。</p>
</blockquote>
<h3 id="函数式思想"><a href="#函数式思想" class="headerlink" title="函数式思想"></a>函数式思想</h3><h4 id="1-常规的重构思路"><a href="#1-常规的重构思路" class="headerlink" title="1. 常规的重构思路"></a>1. 常规的重构思路</h4><p>抽象实体，扩展方法，逻辑复杂之后抽象出辅助方法</p>
<h4 id="2-函数式"><a href="#2-函数式" class="headerlink" title="2. 函数式"></a>2. 函数式</h4><blockquote>
<p>函数式编程的核心理念就是函数是值。（因此函数的typealias的命名规则应与类、结构体相同）</p>
</blockquote>
<p>实例代码链式版本：</p>
<blockquote>
<p>这个例子是你在编写战舰类游戏时可能需要实现的一个核心函数。我们把将要看到的问题归结为,判断一个给定的点是否在射程范围内,并且距离友方船舶和我们自身都不太近。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Foundation</div><div class="line"></div><div class="line"><span class="keyword">typealias</span> <span class="type">Distance</span> = <span class="type">Double</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Position</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x: <span class="type">Double</span></div><div class="line">    <span class="keyword">var</span> y: <span class="type">Double</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Position</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">minus</span><span class="params">(p: Position)</span></span> -&gt; <span class="type">Position</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Position</span>(x: x - p.x, y: y - p.y)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> length: <span class="type">Double</span> &#123;</div><div class="line">        <span class="keyword">return</span> sqrt(x * x + y * y)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ship</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> position: <span class="type">Position</span></div><div class="line">    <span class="keyword">var</span> firingRange: <span class="type">Distance</span></div><div class="line">    <span class="keyword">var</span> unsafeRange: <span class="type">Distance</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Region</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> lookup: <span class="type">Position</span> -&gt; <span class="type">Bool</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Region</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">circle</span><span class="params">(redius: Distance)</span></span> -&gt; <span class="type">Region</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Region</span>(lookup: &#123; point <span class="keyword">in</span> point.length &lt;= redius &#125;)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">shift</span><span class="params">(offset: Position)</span></span> -&gt; <span class="type">Region</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Region</span>(lookup: &#123; point <span class="keyword">in</span> <span class="keyword">self</span>.lookup(point.minus(offset)) &#125;)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">invert</span><span class="params">()</span></span> -&gt; <span class="type">Region</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Region</span>(lookup: &#123; point <span class="keyword">in</span> !<span class="keyword">self</span>.lookup(point) &#125;)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">intersection</span><span class="params">(region: Region)</span></span> -&gt; <span class="type">Region</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Region</span>(lookup: &#123; point <span class="keyword">in</span> <span class="keyword">self</span>.lookup(point) &amp;&amp; region.lookup(point) &#125;)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">union</span><span class="params">(region: Region)</span></span> -&gt; <span class="type">Region</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="type">Region</span>(lookup: &#123; point <span class="keyword">in</span> <span class="keyword">self</span>.lookup(point) || region.lookup(point) &#125;)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">difference</span><span class="params">(minus: Region)</span></span> -&gt; <span class="type">Region</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.intersection(minus.invert())</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Ship</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">canSafelyEngageShip</span><span class="params">(target: Ship, friendly: Ship)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">let</span> unsafeRegion = <span class="type">Region</span>.circle(<span class="keyword">self</span>.unsafeRange)</div><div class="line">        <span class="keyword">let</span> maxfireRegion = <span class="type">Region</span>.circle(<span class="keyword">self</span>.firingRange)</div><div class="line">        <span class="keyword">let</span> rangeRegion = maxfireRegion.difference(unsafeRegion)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> firingRegion = rangeRegion.shift(position)</div><div class="line">        <span class="keyword">let</span> friendlyRegion = unsafeRegion.shift(friendly.position)</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> resultRegion = firingRegion.difference(friendlyRegion)</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> resultRegion.lookup(target.position)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">let</span> myShip = <span class="type">Ship</span>(position: <span class="type">Position</span>(x: <span class="number">2</span>, y: <span class="number">2</span>), firingRange: <span class="number">10</span>, unsafeRange: <span class="number">2</span>)</div><div class="line"><span class="keyword">let</span> enemyShip = <span class="type">Ship</span>(position: <span class="type">Position</span>(x: <span class="number">5</span>, y: -<span class="number">7</span>), firingRange: <span class="number">10</span>, unsafeRange: <span class="number">2</span>)</div><div class="line"><span class="keyword">let</span> friendShip = <span class="type">Ship</span>(position: <span class="type">Position</span>(x: <span class="number">5</span>, y: -<span class="number">5</span>), firingRange: <span class="number">10</span>, unsafeRange: <span class="number">2</span>)</div><div class="line"></div><div class="line">myShip.canSafelyEngageShip(enemyShip, friendly: friendShip)</div></pre></td></tr></table></figure>
<h3 id="类型驱动开发"><a href="#类型驱动开发" class="headerlink" title="类型驱动开发"></a>类型驱动开发</h3><blockquote>
<p>函数生成器，生成预设参数的专用函数。</p>
</blockquote>
<p>一些优势：</p>
<ul>
<li>安全</li>
<li>模块化</li>
<li>清晰易懂</li>
</ul>
<p>柯里化带来的一些好处（重点在于统一类型）：</p>
<blockquote>
<p>按照柯里化⻛格来定义滤镜,我们可以很容易地使用 &gt;&gt;&gt; 运算符将它们进行组合。假如我们用这些函数未柯里化的版本来构建滤镜的话,虽然依然可以写出相同的滤镜,但是这些滤镜的类型将根据它们所接受的参数不同而略有不同。这样一来,想要为这些不同类型的滤镜定义一个统一的组合运算符就要比现在困难得多了。</p>
</blockquote>
<p>自己的感受就是利于统一类型，将额外的参数都包装在生成的函数中，只保留源作为参数，加工之后的结果作为输出，方便对于函数类型的抽象。</p>
<h3 id="Map、Filter和Reduce"><a href="#Map、Filter和Reduce" class="headerlink" title="Map、Filter和Reduce"></a>Map、Filter和Reduce</h3><blockquote>
<p>接受其它函数作为参数的函数有时被称为<em>高阶函数</em>。</p>
</blockquote>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(transform: Element -&gt; T)</span></span> -&gt; [<span class="type">T</span>] &#123;</div><div class="line">        <span class="keyword">var</span> result: [<span class="type">T</span>] = [] </div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> &#123;</div><div class="line">            result.append(transform(x))</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由顶层函数转为了协议扩展，这样做的优点是自动补全更完善，暧昧的命名更少，以及（通常）代码结构更清晰。</p>
<h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(includeElement: Element -&gt; Bool)</span></span> -&gt; [<span class="type">Element</span>] &#123;</div><div class="line">        <span class="keyword">var</span> result: [<span class="type">Element</span>] = []</div><div class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> <span class="keyword">where</span> includeElement(x) &#123;</div><div class="line">            result.append(x) </div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">reduce</span>&lt;T&gt;<span class="params">(initial: T, combine: <span class="params">(T, Element)</span></span></span> -&gt; <span class="type">T</span>) -&gt; <span class="type">T</span> &#123;</div><div class="line">        <span class="keyword">var</span> result = initial <span class="keyword">for</span> x <span class="keyword">in</span> <span class="keyword">self</span> &#123;</div><div class="line">            result = combine(result, x) </div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用reduce实现map跟filter的版本</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">mapUsingReduce</span>&lt;T&gt;<span class="params">(transform: Element -&gt; T)</span></span> -&gt; [<span class="type">T</span>] &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">reduce</span>([]) &#123; result, x <span class="keyword">in</span></div><div class="line">            <span class="keyword">return</span> result + [transform(x)]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">filterUsingReduce</span><span class="params">(includeElement: Element -&gt; Bool)</span></span> -&gt; [<span class="type">Element</span>] &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">reduce</span>([]) &#123; result, x <span class="keyword">in</span></div><div class="line">            <span class="keyword">return</span> includeElement(x) ? result + [x] : result</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="泛型和Any类型"><a href="#泛型和Any类型" class="headerlink" title="泛型和Any类型"></a>泛型和Any类型</h4><blockquote>
<p>Any类型和泛型两者都能用于定义接受两个不同类型参数的函数。然而，理解两者之间的区别至关重要：泛型可以用于定义灵活的函数，类型检查仍然由编译器负责；而Any类型则可以避开Swift的类型系统（所以应该尽可能避免使用）。</p>
</blockquote>
<p>使用泛型允许你无需牺牲类型安全就能够在编译器的帮助下写出灵活的函数；如果使用Any类型，那你就真的孤立无援了。</p>
<h3 id="可选值"><a href="#可选值" class="headerlink" title="可选值"></a>可选值</h3><h4 id="？？操作符"><a href="#？？操作符" class="headerlink" title="？？操作符"></a>？？操作符</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">in</span> x <span class="keyword">operator</span>??</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> ??&lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, defaultValue: T)</span></span> -&gt; <span class="type">T</span> &#123; </div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> x = <span class="keyword">optional</span> &#123;</div><div class="line">        <span class="keyword">return</span> x </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> defaultValue </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//为了避免defaultValue的无效求值</span></div><div class="line"><span class="keyword">in</span> x <span class="keyword">operator</span> ?? &#123; <span class="keyword">associativity</span> <span class="keyword">right</span> <span class="keyword">precedence</span> <span class="number">110</span> &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> ??&lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, @autoclosure defaultValue: <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) -&gt; <span class="type">T</span> &#123; </div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> x = <span class="keyword">optional</span> &#123;</div><div class="line">        <span class="keyword">return</span> x </div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> defaultValue()</div><div class="line">    &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="分支上的可选值"><a href="#分支上的可选值" class="headerlink" title="分支上的可选值"></a>分支上的可选值</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//switch中的使用</span></div><div class="line"><span class="keyword">switch</span> madridPopulation &#123;</div><div class="line">    <span class="keyword">case</span> <span class="number">0</span>?: <span class="built_in">print</span>(<span class="string">"Nobody in Madrid"</span>)</div><div class="line">    <span class="keyword">case</span> (<span class="number">1</span>..&lt;<span class="number">1000</span>)?: <span class="built_in">print</span>(<span class="string">"Less than a million in Madrid"</span>) </div><div class="line">    <span class="keyword">case</span> .<span class="type">Some</span>(<span class="keyword">let</span> x): <span class="built_in">print</span>(<span class="string">"<span class="subst">\(x)</span> people in Madrid"</span>)</div><div class="line">    <span class="keyword">case</span> .<span class="type">None</span>: <span class="built_in">print</span>(<span class="string">"We don't know about Madrid"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//guard中的使用</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">populationDescriptionForCity</span><span class="params">(city: String)</span></span> -&gt; <span class="type">String</span>? &#123; </div><div class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> population = cities[city] <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</div><div class="line">    <span class="keyword">return</span> <span class="string">"The population of Madrid is <span class="subst">\(population * <span class="number">1000</span>)</span>"</span> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="可选映射"><a href="#可选映射" class="headerlink" title="可选映射"></a>可选映射</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(transform: Wrapped -&gt; U)</span></span> -&gt; <span class="type">U</span>? &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> x = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</div><div class="line">        <span class="keyword">return</span> transform(x) </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(f: Wrapped -&gt; U?)</span></span> -&gt; <span class="type">U</span>? &#123;</div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> x = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</div><div class="line">        <span class="keyword">return</span> f(x) </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="为什么使用可选值？"><a href="#为什么使用可选值？" class="headerlink" title="为什么使用可选值？"></a>为什么使用可选值？</h4><p>避免参数不合法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSParameterAssert(param);</div></pre></td></tr></table></figure>
<p>可选类型标识了失败的可能性，类型系统将有助于你捕捉难以察觉的错误。其中一些错误很容易在开发过程中被发现，但是其余的可能会一直留存到生产代码中去。坚持使用可选值能够从根本上杜绝这类错误。</p>
<h3 id="QuickCheck"><a href="#QuickCheck" class="headerlink" title="QuickCheck"></a>QuickCheck</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/01/iOS屏幕旋转那些事/" itemprop="url">
                  iOS屏幕旋转那些事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-01T21:10:55+08:00" content="2016-08-01">
              2016-08-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/01/iOS屏幕旋转那些事/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/01/iOS屏幕旋转那些事/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>本文屏幕旋转方案仅限于兼容iOS8+</p>
</blockquote>
<h3 id="1-从APP层次谈起"><a href="#1-从APP层次谈起" class="headerlink" title="1. 从APP层次谈起"></a>1. 从APP层次谈起</h3><p>APP常见的布局层次如下图所示：<br><img src="http://alithink.com/img/5rotate/app layer.png" alt="app layer.png"><br>当工程目标开启了多个屏幕方向之后，具体类中有关屏幕旋转的配置其实只与当前屏幕展示模块的最外层VC容器有关。<br>但由于往往存在容器中某些VC针对屏幕旋转的个性化配置，所以需要进行从里层VC到外层容器的旋转状态传递。例如： </p>
<ul>
<li>里层UIViewController的配置</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">shouldAutorotate</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">supportedInterfaceOrientations</span><span class="params">()</span></span> -&gt; <span class="type">UIInterfaceOrientationMask</span> &#123;</div><div class="line">    <span class="keyword">return</span> .<span class="type">Portrait</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">preferredInterfaceOrientationForPresentation</span><span class="params">()</span></span> -&gt; <span class="type">UIInterfaceOrientation</span> &#123;</div><div class="line">    <span class="keyword">return</span> .<span class="type">Portrait</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>自定义UINavigationController的配置</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">shouldAutorotate</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.viewControllers.last?.shouldAutorotate() ?? <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">supportedInterfaceOrientations</span><span class="params">()</span></span> -&gt; <span class="type">UIInterfaceOrientationMask</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.viewControllers.last?.supportedInterfaceOrientations() ?? .<span class="type">Portrait</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">preferredInterfaceOrientationForPresentation</span><span class="params">()</span></span> -&gt; <span class="type">UIInterfaceOrientation</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.viewControllers.last?.preferredInterfaceOrientationForPresentation() ?? .<span class="type">Portrait</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>自定义UITabBarController的配置</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">shouldAutorotate</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.selectedViewController?.shouldAutorotate() ?? <span class="literal">false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">supportedInterfaceOrientations</span><span class="params">()</span></span> -&gt; <span class="type">UIInterfaceOrientationMask</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.selectedViewController?.supportedInterfaceOrientations() ?? .<span class="type">Portrait</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">preferredInterfaceOrientationForPresentation</span><span class="params">()</span></span> -&gt; <span class="type">UIInterfaceOrientation</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.selectedViewController?.preferredInterfaceOrientationForPresentation() ?? .<span class="type">Portrait</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-AppDelegate配置"><a href="#2-AppDelegate配置" class="headerlink" title="2. AppDelegate配置"></a>2. AppDelegate配置</h3><p>按照上面的方法配置好后，就可以自由的控制转屏了，但在某些情况下会存在问题，举个例子：假如A页面屏幕锁定为竖屏，点击A页面的一个按钮跳转到了B页面（方式存在push跟present两种），B页面是可以进行横竖屏旋转的，当B页面旋转至横屏，这时候点击返回，会发现A页面也变成横屏展示了，而且无法通过屏幕旋转恢复到竖屏展示。这时候下面这个代理方法就排上用场了：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, supportedInterfaceOrientationsForWindow window: UIWindow?)</span></span> -&gt; <span class="type">UIInterfaceOrientationMask</span> &#123;    </div><div class="line">    <span class="comment">// 限定所有present的模态视图只能竖屏</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.window?.rootViewController?.presentedViewController != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">return</span> .<span class="type">Portrait</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// 限定容器中当前展示的为RotateDetailViewController的实例时可以旋屏，其余页面只能竖屏</span></div><div class="line">    <span class="keyword">let</span> baseTabBarController = <span class="keyword">self</span>.window?.rootViewController <span class="keyword">as</span>? <span class="type">BaseTabBarController</span></div><div class="line">    <span class="keyword">if</span> ((baseTabBarController?.selectedViewController <span class="keyword">as</span>? <span class="type">BaseNavigationController</span>)?.topViewController <span class="keyword">is</span> <span class="type">RotateDetailViewController</span> &#123;</div><div class="line">        <span class="keyword">return</span> .<span class="type">AllButUpsideDown</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> .<span class="type">Portrait</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-强制旋屏"><a href="#3-强制旋屏" class="headerlink" title="3. 强制旋屏"></a>3. 强制旋屏</h3><blockquote>
<p>前提条件：该VC允许旋转</p>
</blockquote>
<ul>
<li>强制竖屏</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">forcePortrait</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">let</span> width = <span class="type">UIScreen</span>.mainScreen().bounds.size.width</div><div class="line">    <span class="keyword">let</span> height = <span class="type">UIScreen</span>.mainScreen().bounds.size.height</div><div class="line">    </div><div class="line">    <span class="keyword">let</span> isLandscape = width &gt; height</div><div class="line">    <span class="keyword">if</span> isLandscape &#123;</div><div class="line">        <span class="keyword">let</span> device = <span class="type">UIDevice</span>.currentDevice()</div><div class="line">        <span class="keyword">let</span> number = <span class="type">NSNumber</span>(integer: <span class="type">UIInterfaceOrientation</span>.<span class="type">Portrait</span>.rawValue)</div><div class="line">        device.setValue(number, forKey: <span class="string">"orientation"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>强制横屏</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">forceLandScape</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">let</span> width = <span class="type">UIScreen</span>.mainScreen().bounds.size.width</div><div class="line">    <span class="keyword">let</span> height = <span class="type">UIScreen</span>.mainScreen().bounds.size.height</div><div class="line">    </div><div class="line">    <span class="keyword">let</span> isLandscape = width &lt; height</div><div class="line">    <span class="keyword">if</span> isLandscape &#123;</div><div class="line">        <span class="keyword">let</span> device = <span class="type">UIDevice</span>.currentDevice()</div><div class="line">        <span class="keyword">let</span> number = <span class="type">NSNumber</span>(integer: <span class="type">UIInterfaceOrientation</span>.<span class="type">LandscapeRight</span>.rawValue)</div><div class="line">        device.setValue(number, forKey: <span class="string">"orientation"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>以上方案基本可以搞定大部分的屏幕旋转场景了。如果APP的产品需求中主体为固定方向，只要求对弹出(present)模态视图进行旋转的话，可以参考下面这篇文章：<br><a href="http://swiftiostutorials.com/ios-orientations-landscape-orientation-one-view-controller/" target="_blank" rel="external">iOS Orientations: Landscape orientation for only one View Controller</a><br>这么做会更加方便一些，但问题是这种方案对于push模式的场景并不适用，需要结合以上方案综合解决。  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/25/Charts诊疗日志/" itemprop="url">
                  Charts诊疗日志
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-25T15:41:16+08:00" content="2016-07-25">
              2016-07-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/25/Charts诊疗日志/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/25/Charts诊疗日志/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>用Charts有一段时间了，期间遇到了一些现有版本存在的问题，特作此记录。<br><a href="https://github.com/danielgindi/Charts" target="_blank" rel="external">Charts传送门</a></p>
</blockquote>
<h2 id="病症1-组合图-CombinedChartView-弹出MarkerView位置不对"><a href="#病症1-组合图-CombinedChartView-弹出MarkerView位置不对" class="headerlink" title="病症1.组合图(CombinedChartView)弹出MarkerView位置不对"></a>病症1.组合图(CombinedChartView)弹出MarkerView位置不对</h2><h3 id="病症表象如下图："><a href="#病症表象如下图：" class="headerlink" title="病症表象如下图："></a>病症表象如下图：</h3><p><img src="http://alithink.com/img/4charts/combine.png" alt="combine.png"></p>
<p>截图为想要的结果（修复后的效果），实际情况为弹出的Marker没有显示在对应折线图的数据点上。</p>
<h3 id="患病位置如下图："><a href="#患病位置如下图：" class="headerlink" title="患病位置如下图："></a>患病位置如下图：</h3><p><img src="http://alithink.com/img/4charts/chart_marker.png" alt="chart_marker.png"></p>
<h3 id="治疗方案："><a href="#治疗方案：" class="headerlink" title="治疗方案："></a>治疗方案：</h3><p>BarLineChartViewBase -&gt; getMarkerPosition  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> pt = <span class="type">CGPoint</span>(x: xPos, y: yPos * _animator.phaseY)</div></pre></td></tr></table></figure>
<p>在pt初始化之后添加如下分支：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="keyword">self</span> <span class="keyword">is</span> <span class="type">CombinedChartView</span> &#123;</div><div class="line">    <span class="keyword">let</span> combinedChartView = <span class="keyword">self</span> <span class="keyword">as</span>! <span class="type">CombinedChartView</span></div><div class="line">    <span class="keyword">let</span> combinedChartData = _data <span class="keyword">as</span>! <span class="type">CombinedChartData</span></div><div class="line">            </div><div class="line">    <span class="keyword">if</span> highlight.dataIndex &gt;= <span class="number">0</span> &amp;&amp; highlight.dataIndex &lt; combinedChartView.drawOrder.<span class="built_in">count</span> &#123;</div><div class="line">        <span class="keyword">let</span> chartType =  <span class="type">CombinedChartView</span>.<span class="type">DrawOrder</span>(rawValue: combinedChartView.drawOrder.<span class="built_in">reverse</span>()[highlight.dataIndex])!</div><div class="line">        <span class="keyword">var</span> axisDependency = <span class="type">ChartYAxis</span>.<span class="type">AxisDependency</span>.<span class="type">Left</span></div><div class="line">                </div><div class="line">        <span class="keyword">switch</span> chartType &#123;</div><div class="line">        <span class="keyword">case</span> .<span class="type">Bar</span>:</div><div class="line">            axisDependency = combinedChartData.barData.getDataSetByIndex(dataSetIndex)!.axisDependency</div><div class="line">        <span class="keyword">case</span> .<span class="type">Line</span>:</div><div class="line">            axisDependency = combinedChartData.lineData.getDataSetByIndex(dataSetIndex)!.axisDependency</div><div class="line">        <span class="keyword">case</span> .<span class="type">Bubble</span>:</div><div class="line">            axisDependency = combinedChartData.bubbleData.getDataSetByIndex(dataSetIndex)!.axisDependency</div><div class="line">        <span class="keyword">case</span> .<span class="type">Candle</span>:</div><div class="line">            axisDependency = combinedChartData.candleData.getDataSetByIndex(dataSetIndex)!.axisDependency</div><div class="line">        <span class="keyword">case</span> .<span class="type">Scatter</span>:</div><div class="line">            axisDependency = combinedChartData.scatterData.getDataSetByIndex(dataSetIndex)!.axisDependency</div><div class="line">        &#125;</div><div class="line">        getTransformer(axisDependency).pointValueToPixel(&amp;pt)</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    getTransformer(data.getDataSetByIndex(dataSetIndex)!.axisDependency).pointValueToPixel(&amp;pt)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>此处drawOrder.reverse()要做reverse的原因是highlight里面记录的dataIndex的顺序正好与drawOrder数组的顺序相反，例如drawOrder为[Bar, Line],那么对应的Bar的dataIndex为1，Line的dataIndex为0。</p>
</blockquote>
<h3 id="总结分析"><a href="#总结分析" class="headerlink" title="总结分析"></a>总结分析</h3><p>CombinedChartView中包含的各类图形的数据会保存在独立的data属性中，例如柱状图的barData,折线图的lineData。因此原有的从统一data属性取得dataSet对应参考轴的操作就会返回错误的结果，以致因为选错了参考轴计算出了错误的Marker绘制位置。</p>
<h2 id="病症2-堆积图弹出MarkerView数值不对"><a href="#病症2-堆积图弹出MarkerView数值不对" class="headerlink" title="病症2.堆积图弹出MarkerView数值不对"></a>病症2.堆积图弹出MarkerView数值不对</h2><h3 id="病症表象如下图：-1"><a href="#病症表象如下图：-1" class="headerlink" title="病症表象如下图："></a>病症表象如下图：</h3><p><img src="http://alithink.com/img/4charts/stack.png" alt="stack.png"></p>
<p>截图为想要的结果（修复后的效果），实际情况为弹出的Marker总是显示所有柱子的叠加值。</p>
<h3 id="治疗方案：-1"><a href="#治疗方案：-1" class="headerlink" title="治疗方案："></a>治疗方案：</h3><p>BalloonMarker -&gt; refreshContent</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> entry <span class="keyword">is</span> <span class="type">BarChartDataEntry</span> &amp;&amp; highlight.stackIndex != -<span class="number">1</span> &#123;</div><div class="line">    <span class="keyword">let</span> chartEntry = entry <span class="keyword">as</span>! <span class="type">BarChartDataEntry</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">let</span> values = chartEntry.values &#123;</div><div class="line">        configLabelns(entry, value: values[highlight.stackIndex])</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    configLabelns(entry)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>首先目前只有柱状图支持堆积展现，并且进行堆积展示的BarChartDataEntry有一个values属性用于存放该列的所有堆积值；stackIndex用于标示当前点击的柱子从下往上的序列，例如最下面的柱子为0，之上一个为1，依次递增。</p>
</blockquote>
<h3 id="总结分析-1"><a href="#总结分析-1" class="headerlink" title="总结分析"></a>总结分析</h3><p>默认的Marker处理值展示的时候，没有考虑到堆积图的特殊性，统一从entry的value属性进行取值，导致最终展现的数值不是我们想要的结果。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/20/《世界简史》略读/" itemprop="url">
                  《世界简史》略读
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-20T20:50:49+08:00" content="2016-07-20">
              2016-07-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读过的书/" itemprop="url" rel="index">
                    <span itemprop="name">读过的书</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/20/《世界简史》略读/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/20/《世界简史》略读/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="生命的起源"><a href="#生命的起源" class="headerlink" title="生命的起源"></a>生命的起源</h3><ul>
<li>沉积岩（岩石记录）大致可以了解到16亿年前的生命形态。</li>
<li>包含着生命迹象的最初的岩石称为原生岩。</li>
</ul>
<blockquote>
<p>古生代早期：比较低等的生物遗迹如水生贝类的贝壳、植物状动物的花状头、海藻、沙蚕类的甲壳类生物足迹和骨骼化石。<br>三叶虫：最早出生的生物，跟蚜虫十分相似，他们能像蚜虫那样把身体卷成球状。<br>海蝎：过了几百万年出现，比之前的生物更灵活有力</p>
</blockquote>
<h3 id="鱼类时期"><a href="#鱼类时期" class="headerlink" title="鱼类时期"></a>鱼类时期</h3><h4 id="生物区别于非生命体的两个特征："><a href="#生物区别于非生命体的两个特征：" class="headerlink" title="生物区别于非生命体的两个特征："></a>生物区别于非生命体的两个特征：</h4><ul>
<li>能够通化其他物质，使其成为自身的一部分（吃东西）。</li>
<li>可以再造自己（繁衍后代）。</li>
</ul>
<blockquote>
<p>鱼类时期（泥盆季）：大约在5亿年以前，已知的最早的脊椎动物。他们起初的样子跟现在的鲨鱼、鲟鱼有些相似。</p>
</blockquote>
<h3 id="石炭纪沼泽期"><a href="#石炭纪沼泽期" class="headerlink" title="石炭纪沼泽期"></a>石炭纪沼泽期</h3><p>植物先于动物移居到陆地上。</p>
<blockquote>
<p>植物：大型湿地木质植物，如木质苔藓、木质蕨类、巨型木贼等。<br>动物：蜈蚣、马路、原生昆虫（体型较大，如巨型蜻蜓）、蜘蛛蝎子的祖先，随后脊椎动物登陆。<br>肺的进化。<br>末期温度剧烈变化，沼泽地植物完全消失，煤炭层的形成基础。</p>
</blockquote>
<h3 id="爬行动物时期"><a href="#爬行动物时期" class="headerlink" title="爬行动物时期"></a>爬行动物时期</h3><ul>
<li>卵生，在孵化完成前就已经接近发育的成熟阶段。</li>
<li>出现了结籽植物。</li>
</ul>
<blockquote>
<p>爬行动物时期（中生代）：持续到距今大约8000万年以前，之前称为古生代和无生代（共14亿年）。中生代大约持续了两亿年以上。之后称为新生代。<br>动物：各种恐龙以及其他爬行动物。</p>
</blockquote>
<h3 id="哺乳动物时期"><a href="#哺乳动物时期" class="headerlink" title="哺乳动物时期"></a>哺乳动物时期</h3><p>此时的地图版图和现在的世界地图看起来有些大致相似了。<br>新生代与中生代生物的最根本区别，在于它们的精神生活不同。这种差别就其本质来说，主要是来源于母体和后代之间不同程度的接触。爬行动物和后代几乎没有接触。除个别特例之外，爬行动物在产卵之后就会自行离开，任其自生自灭。新生代以哺育和抚养后代为特点。</p>
<blockquote>
<p>灵长目：狐猿、猿、类人猿和人（解刨学上的相似性）<br>一共四次冰河时期。第一次距今60万年，最后一次距今约5万年。最后一次冰河时期，类人猿开始出现。<br>新石器时代：大约在10000到12000年以前。</p>
</blockquote>
<h3 id="文明雏形"><a href="#文明雏形" class="headerlink" title="文明雏形"></a>文明雏形</h3><p>大约公元前6000年</p>
<h4 id="文字"><a href="#文字" class="headerlink" title="文字"></a>文字</h4><ul>
<li>字母文字<ul>
<li>苏美尔：楔形文字</li>
<li>埃及：象形文字</li>
</ul>
</li>
<li>中国：象形文字</li>
</ul>
<h4 id="汉谟拉比法典"><a href="#汉谟拉比法典" class="headerlink" title="汉谟拉比法典"></a>汉谟拉比法典</h4><p>公元前2100年巴比伦帝国</p>
<h3 id="犹太人"><a href="#犹太人" class="headerlink" title="犹太人"></a>犹太人</h3><ul>
<li>希伯来人-闪米特系的民族。</li>
<li>公元前1000年之前，就定居在犹地亚，首都一直是耶路撒冷。</li>
<li>《旧约》（希伯来圣经），公元前4世纪或5世纪。</li>
</ul>
<h3 id="希腊文明"><a href="#希腊文明" class="headerlink" title="希腊文明"></a>希腊文明</h3><p>促使希腊各个城邦形成一个整体的原因： </p>
<ul>
<li>史诗</li>
<li>每四年在奥林匹亚举行一次奥运会</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/08/联通旧事/" itemprop="url">
                  联通旧事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-08T20:37:56+08:00" content="2016-07-08">
              2016-07-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/回忆录/" itemprop="url" rel="index">
                    <span itemprop="name">回忆录</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/08/联通旧事/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/08/联通旧事/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>时间：2011.3~2013.6</p>
</blockquote>
<h3 id="初来乍到"><a href="#初来乍到" class="headerlink" title="初来乍到"></a>初来乍到</h3><blockquote>
<p>出场人物代号简介：<br>我：初出茅庐的Java小菜鸟</p>
</blockquote>
<p>　　那是一个属于Java的年代（^_^其实现在依然如此）。但造化弄人一直没有长时间从事相关工作。在浪潮实习的时候用了C#，在另一个伤心之地（实在不想提。。唉。。）用了一盏茶的J2EE和PB，而后我来到了联通。<br>　　面试时问的问题都是J2EE相关的，于是顺利的加入了经分数据组😂（跟J2EE几乎没半毛钱关系，这就是命吧，不过现在回想，还是要感谢一下命运之神）。时间太久，忘记当时的心情了，只依稀记得当时坐到工位上，时而会慨叹：“也许我就要跟数据库、etl和shell搞一辈子了吧”。</p>
<h3 id="误打误撞"><a href="#误打误撞" class="headerlink" title="误打误撞"></a>误打误撞</h3><blockquote>
<p>出场人物代号简介:<br>川哥：掌分项目的发起者<br>老孟：掌分项目组长以及同甘共苦过的兄弟</p>
</blockquote>
<p>　　同事领导都挺好，身边也有不少同学，所以日子过得还算温馨舒适。然后突然有一天命运的轨迹就发生了改变，在集团常驻的川哥发起了掌上经分项目（仅限iOS端）。  </p>
<blockquote>
<p>回想当时iOS生态圈的境况为：<br>目标设备：iPhone3G、3GS、iPad1<br>iOS版本: iOS4.x<br>开发设备：iMac、黑苹果(t410黑)<br>开发环境：那是一个Xcode与Interface builder分离的时代</p>
</blockquote>
<p>　　迷迷瞪瞪的就跟老孟被安排进了掌分项目组，当时对于OSX（现在应该叫macOS啦）和iOS一无所知，唯一的学习资料是一本iPhone开发书籍（名字忘掉了，这本书其中之一的作者以外包团队领头人的身份加入了项目）。项目的第一个版本主要由外包团队负责研发，但是我跟老孟需要尽快的融入进来，借助项目快速上手iOS开发，然后将项目接手过来（最大限度的节省外包费用，😂据说最后也没有把外包团队的费用完全结清）。</p>
<h3 id="小有所成"><a href="#小有所成" class="headerlink" title="小有所成"></a>小有所成</h3><blockquote>
<p>军军：外包团队主力开发<br>苟工：外包团队领头人</p>
</blockquote>
<p>　　那是一个几乎没有轮子的时代，或者说当时都还没有使用过github的我没有具备找轮子的能力。所以几乎所有的东西都是从零做起，走过的坑不少，但是收获也很大，很快就可以上手一些简单模块的开发了。说起成长的喜悦，记得兄弟们一起加班时的免费餐补报销，加班九点之后的打车报销以及写出bug后大家开玩笑的声讨书（那超大字号的白底黑字，打开屏幕吓出一身冷汗来）。<br>　　这里要感谢下苟工当时对于delegate的悉心讲解，感谢军军同志对于我冒出的各种问题的耐心解答。
　　</p>
<h3 id="北京你好"><a href="#北京你好" class="headerlink" title="北京你好"></a>北京你好</h3><blockquote>
<p>博士：名副其实的博士，会议室加班常客，只因为大家都叫他博士，导致往往有些人都不记得他叫什么名字了，但是我记得，因为他跟托塔李天王重名^_^<br>文哥：目前公司的领导</p>
</blockquote>
<p>　　当领导让你出差，但是又不明确说多少天的时候，你就应该明白我可能一时半会回不来了😂。就这样，北京，我来了。<br>　　在项目的初版汇报通过之后，我们来到了北京金融街21号-联通集团总部，开始了现场开发支持工作。想象过一个人提着iMac盒子出差的感受吗，回想起来，好心酸，胳膊也好酸。。。<br>　　常驻联通会议室之后，发现一个真相，原来工作之后需要掌握的一项重要技能就是做PPT。逐级的汇报，不停的过片子，修改字眼与内容的组织是博士经常加班到很晚的原因。记得我们晚上从集团运动区打完球回来，还能经常享受到博士亲切地问候。<br>　　博士给我留下了很深刻的印象，跟现在的文哥有一拼，为人温文尔雅，专业知识过硬，处事细致全面，知识面很广，仿佛所有的东西都有所涉猎并且见解独特。（这里声明下，绝无拍马屁之嫌）<br>　　集团的食堂也给我留下了不少美味的回忆，超值的早餐、便宜好吃的肉龙等等，现在想想当时没有胖起来真是个奇迹。（然而在我的不懈努力下，现在终于还是胖起来了）
　　</p>
<h3 id="重新来过"><a href="#重新来过" class="headerlink" title="重新来过"></a>重新来过</h3><p>　　终于热更新这个问题被提出来了，Native开发的最大不足其实就是这里了。当时没有如今大行其道的JSPatch、风风火火的React Native，于是开发一时进入了瓶颈。想过不少方案都没有很好的解决这个问题，于是川哥决定借助现有的成熟平台换一个架构重新来过。<br>　　经过几轮讨论之后，确定了MicroStrategy的方案，至今跟厂商的几个伙伴还保持着联系，毕竟国内懂得定制化改造MSTR SDK的iOS开发者估计不算多，当时一起讨论了不少问题，还乔装成他们的技术人员去帮他们紧急搞定了一个项目^_^。<br>　　实体、事实、度量、选择器、报表、文档、智能立方体、缓存、权限。。。接触了不少商业智能常见的概念与功能。起初是比较排斥的，因为借助第三方平台就基本失去了实际编写功能代码的机会了（因为涉及二次开发，针对MSTR SDK套壳的部分还是需要编写的）。但转念一想既然改变的势头已无法扭转，那只有硬着头皮顺流而行了。因为处女座的特质，让我在很短的时间内就掌握了MSTR的基本功能，有疑惑的地方就联系厂商技术支持，所以很快MSTR版本的掌分就搞出来了。</p>
<blockquote>
<p>心里话：<br>不知道现在掌分的状况如何了，个人一直觉得中途换成MSTR的方案并不是一个明智的选择，原因如下：  </p>
<ol>
<li>APP其实往往不需要彻底的动态性，内容的动态性往往可以通过产品向的方案进行解决。  </li>
<li>MSTR的权限以及缓存模型是基于用户的，而用户又涉及到license的费用计算，一旦涉及到费用就会衍生出不少扯皮的事情；反观自主开发的APP这部分配置就非常灵活。  </li>
<li>这点我觉得最重要，那就是APP存在的重要意义之一其实就是她极致的用户体验，如果在动态性与极致用户体验之一做个权衡的话，会毫不犹豫的以保证后者为先。（尤其在企业应用的范畴内，省掉了App Store的审核成本，版本的迭代速度可以非常快，版本的更新提示反而可以算作是对于用户的一种引导）</li>
</ol>
</blockquote>
<h3 id="北京再见"><a href="#北京再见" class="headerlink" title="北京再见"></a>北京再见</h3><blockquote>
<p>朋友们：东儿、芳芳*2、小杜、传奇、夺儿等（排名不分先后）</p>
</blockquote>
<p>　　来到北京最开心的回忆就是跟一起出差的朋友们几乎游遍了京城所有可玩的地方。故宫、天坛、长城、颐和园、南锣鼓巷、后海、雍和宫、国家博物馆、国家图书馆、鸟巢、水立方、清华北大、前门、王府井、西单、三里屯（优衣库试衣间）等。借老孟跟东儿的单反留下了不少记忆的片段，现在还经常看一下当时的照片，回味当初那份单纯的快乐，这份快乐只属于那段日子，那个年纪。（着重提一下，菜市口附近教子胡同里面的一个麻辣烫小店，里面的辣椒太tm过瘾了。。。）<br>　　唯一不变的就是变化，突然因为项目成本的原因（还有一些其他原因）研发团队就回到了济南。模式变为了济南团队研发结束提交变更，留守在集团的老孟负责向领导进行汇报安装。  </p>
<blockquote>
<p>说说这段日子的收获：  </p>
<ol>
<li>扩展视野、吃喝玩乐、结交朋友算是一方面😜。  </li>
<li>中途也参加了一些iOS精通类以及用户体验类的培训，总算是给我这个自学党补了补漏。  </li>
<li>接触MSTR，熟悉了主流报表平台的常用概念以及构建流程；通过对SDK的二次开发，为了实现一些奇葩需求，了解了不少iOS相关的黑魔法（swizzling、runtime等）</li>
</ol>
</blockquote>
<h3 id="联通再见"><a href="#联通再见" class="headerlink" title="联通再见"></a>联通再见</h3><p>　　人忙起来往往没时间去想太多其他事情，可一旦闲下来，然后再有不爽的任务压过来时，就往往会思考权衡下自己将来要走的路了。当掌分的工作暂时告一段落，领导打算安排去做其他数据加工审核相关工作的时候，心里总是有种排斥感。那段时间心里总是有个声音在问自己，将来到底想做什么。联通的生活确实很安逸舒适，但自己内心坚持移动端研发方向，所以最后还是选择了离开。    </p>
<blockquote>
<p>后记：<br>在联通工作的这段日子，结识了伙伴，扩展了视野，最重要的是确定了自己下一步该走的路。<br>感谢那段时光，感谢那段日子有你们相伴。年轻万岁，青春无悔。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/01/《禅与 Objective-C 编程艺术》读书拾遗/" itemprop="url">
                  《禅与 Objective-C 编程艺术》读书拾遗
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-01T10:49:23+08:00" content="2016-07-01">
              2016-07-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/读过的书/" itemprop="url" rel="index">
                    <span itemprop="name">读过的书</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/01/《禅与 Objective-C 编程艺术》读书拾遗/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/01/《禅与 Objective-C 编程艺术》读书拾遗/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>纯粹拾遗性质的读书笔记，只记录知识体系尚模糊的内容<br>原文链接：<a href="https://github.com/oa414/objc-zen-book-cn#%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B" target="_blank" rel="external">《禅与 Objective-C 编程艺术》</a></p>
</blockquote>
<h3 id="1-条件语句"><a href="#1-条件语句" class="headerlink" title="1.条件语句"></a>1.条件语句</h3><ul>
<li>善用return, 将主流程从分支中脱离</li>
</ul>
<h3 id="2-命名"><a href="#2-命名" class="headerlink" title="2.命名"></a>2.命名</h3><ul>
<li>常量 static NSString * const ZOCCacheNotification(尽量避免使用宏，除非真的需要用到她)</li>
<li>with连接 取代and</li>
<li>字面量<ul>
<li>不可变集合尽量使用字面量赋值</li>
<li>可变集合避免[@[] mutableCopy]</li>
</ul>
</li>
</ul>
<h3 id="3-类"><a href="#3-类" class="headerlink" title="3.类"></a>3.类</h3><ul>
<li>类命名规范：ZOC(前缀)+Twitter(子类)+NetworkClient(父类)</li>
<li>推荐代码组织顺序：<ul>
<li>dealloc(MRC)</li>
<li>init<ul>
<li>designated initializer</li>
<li>secondary initializer</li>
</ul>
</li>
</ul>
</li>
<li>init的可失败性</li>
<li>提供自己的初始化函数的三个步骤<ul>
<li>定义你的designated initializer, 确保调用了直接超类designated initializer</li>
<li>重载直接超类的designated initializer。调用你的新的designated initializer</li>
<li>为新的designated initializer写文档</li>
</ul>
</li>
<li><p>类簇：</p>
<ul>
<li><p>简单示例：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@implementation ZOCKintsugiPhotoViewController</div><div class="line"></div><div class="line">- (id)initWithPhotos:(NSArray *)photos</div><div class="line">&#123;</div><div class="line">  		if ([self isMemberOfClass:ZOCKintsugiPhotoViewController.class]) &#123;</div><div class="line">      		self = nil;</div><div class="line"></div><div class="line">      		if ([UIDevice isPad]) &#123;</div><div class="line">          		self = [[ZOCKintsugiPhotoViewController_iPad alloc] initWithPhotos:photos];</div><div class="line">      		&#125;</div><div class="line">      		else &#123;</div><div class="line">          		self = [[ZOCKintsugiPhotoViewController_iPhone alloc] initWithPhotos:photos];</div><div class="line">      		&#125;</div><div class="line">      		return self;</div><div class="line">  		&#125;</div><div class="line">  		return [super initWithNibName:nil bundle:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>单例模式应该运用于类及类的接口趋向于作为单例来使用的情况</p>
</li>
<li>属性：<ul>
<li>NSString *text</li>
<li>总应该使用getter和setter</li>
<li>永远不要在init方法里面用getter和setter(dealloc中同样需要注意)</li>
<li>使用点符号会让表达更加清晰并且帮助区分属性访问和方法调用</li>
<li>属性定义推荐格式：@property (nonatomic, readwrite, copy) NSString *name;</li>
<li>BOOL类型推荐格式：@property (assign, getter=isEditable) BOOL editable;</li>
<li>通过readonly的属性暴露类内部可变属性的值</li>
</ul>
</li>
<li><p>相等性示例：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (BOOL)isEqual:(id)object &#123;</div><div class="line">   	if (self == object) &#123;</div><div class="line">     		return YES;</div><div class="line">   	&#125;</div><div class="line"></div><div class="line">   	if (![object isKindOfClass:[ZOCPerson class]]) &#123;</div><div class="line">     		return NO;</div><div class="line">   	&#125;</div><div class="line"></div><div class="line">   	return [self isEqualToPerson:(ZOCPerson *)object];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)isEqualToPerson:(Person *)person &#123;</div><div class="line">   	if (!person) &#123;</div><div class="line">       	return NO;</div><div class="line">   	&#125;</div><div class="line"></div><div class="line">   	BOOL namesMatch = (!self.name &amp;&amp; !person.name) ||</div><div class="line">                      [self.name isEqualToString:person.name];</div><div class="line">   	BOOL birthdaysMatch = (!self.birthday &amp;&amp; !person.birthday) ||</div><div class="line">                          [self.birthday isEqualToDate:person.birthday];</div><div class="line"></div><div class="line"> 		return haveEqualNames &amp;&amp; haveEqualBirthdays;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-Category"><a href="#4-Category" class="headerlink" title="4.Category"></a>4.Category</h3><ul>
<li>category方法前加上自己的小写前缀以及下划线，避免重名的category方法的覆盖不确定性</li>
<li>利用category创建方法分组可以用来更好地进行不同功能的表示，并且把类打破在更多自我包含的组成部分里</li>
</ul>
<h3 id="5-Protocols"><a href="#5-Protocols" class="headerlink" title="5.Protocols"></a>5.Protocols</h3><ul>
<li>当实现一个protocol你总应该坚持里氏替换原则。这个原则是：你应该可以取代任意接口实现，而不用改变客户端或者相关实现</li>
</ul>
<h3 id="6-NSNotification"><a href="#6-NSNotification" class="headerlink" title="6.NSNotification"></a>6.NSNotification</h3><ul>
<li>通知名定义示例：extern NSString * const ZOCFooDidBecomeBarNotification;</li>
</ul>
<h3 id="7-代码组织"><a href="#7-代码组织" class="headerlink" title="7.代码组织"></a>7.代码组织</h3><ul>
<li>清晰地组织代码和规范地进行定义，是你对自己以及其他阅读代码的人的尊重</li>
<li>善用代码块({})</li>
<li><p>pragma示例：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">- (void)dealloc &#123; /* ... */ &#125;</div><div class="line">- (instancetype)init &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - View Lifecycle （View 的生命周期）</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123; /* ... */ &#125;</div><div class="line">- (void)viewWillAppear:(BOOL)animated &#123; /* ... */ &#125;</div><div class="line">- (void)didReceiveMemoryWarning &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - Custom Accessors （自定义访问器）</div><div class="line"></div><div class="line">- (void)setCustomProperty:(id)value &#123; /* ... */ &#125;</div><div class="line">- (id)customProperty &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - IBActions  </div><div class="line"></div><div class="line">- (IBAction)submitData:(id)sender &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - Public</div><div class="line"></div><div class="line">- (void)publicMethod &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - Private</div><div class="line"></div><div class="line">- (void)zoc_privateMethod &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - UITableViewDataSource</div><div class="line"></div><div class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123; /* ... */ &#125;</div><div class="line"></div><div class="line">#pragma mark - ZOCSuperclass</div><div class="line"></div><div class="line">// ... 重载来自 ZOCSuperclass 的方法</div><div class="line"></div><div class="line">#pragma mark - NSObject</div><div class="line"></div><div class="line">- (NSString *)description &#123; /* ... */ &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>#pragma unused</p>
</li>
<li>#error #warning</li>
</ul>
<h3 id="8-对象间的通讯"><a href="#8-对象间的通讯" class="headerlink" title="8.对象间的通讯"></a>8.对象间的通讯</h3><ul>
<li>Block<ul>
<li>把需要提供的数据和错误信息整合到一个单独block中，比分别提供成功和失败的block要好<ul>
<li>若objects不为nil,则error必须为nil</li>
<li>若objects为nil,则error必须不为nil</li>
</ul>
</li>
<li>三种方案的讨论（循环引用相关）</li>
</ul>
</li>
<li>委托和数据源<ul>
<li>委托模式：事件发生的时候，委托者需要通知代理者</li>
<li>数据源模式：委托者需要从数据源对象拉去数据<ul>
<li>重载代理方法：instancesRespondToSelector</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="9-面向切面编程"><a href="#9-面向切面编程" class="headerlink" title="9.面向切面编程"></a>9.面向切面编程</h3><ul>
<li>aspects</li>
<li>应用举例 统计与日志：<ul>
<li>预先留一个统计的配置文件，记录需要统计的类、方法跟标签</li>
<li>初始化时统一埋点</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/28/BI APP图形库选型/" itemprop="url">
                  BI APP图形库选型
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-28T09:55:04+08:00" content="2016-06-28">
              2016-06-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/28/BI APP图形库选型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/28/BI APP图形库选型/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>BI中会涉及到不少图形可视化的应用，因为考虑到APP用户体验方面的需求（移动端版本主要面向集团领导使用），BI APP主要采用Native的图形可视化解决方案（当然Swift优先^_^）。</p>
<h3 id="涉及的图形类型"><a href="#涉及的图形类型" class="headerlink" title="涉及的图形类型"></a>涉及的图形类型</h3><p><img src="http://alithink.com/img/3bi/1.png" alt="BI show.png"></p>
<p>BI 中的各种图形图表都封装成了对应的卡片类型，根据接口的卡片类型描述动态生成对应的数据卡片进行展示。</p>
<h3 id="开源库选型"><a href="#开源库选型" class="headerlink" title="开源库选型"></a>开源库选型</h3><h4 id="1-Charts"><a href="#1-Charts" class="headerlink" title="1.Charts"></a>1.Charts</h4><blockquote>
<p>传送门：<a href="https://github.com/danielgindi/Charts" target="_blank" rel="external">https://github.com/danielgindi/Charts</a>  </p>
</blockquote>
<h5 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a>应用场景：</h5><p>主力图形库，常规图形的展示。</p>
<h5 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h5><ul>
<li>图形类型支持覆盖率较高，基本涵盖了所有常用的图形类型（组合图待完善中…）。</li>
<li>文档较完备，且iOS、Android平台接口一致，迁移成本低</li>
<li>图形库热度高，持续更新中。</li>
<li>较为优雅的动画支持、默认数据展示区域的控制、各种展示细节的灵活控制等。</li>
</ul>
<h4 id="2-ESArcProgressView"><a href="#2-ESArcProgressView" class="headerlink" title="2.ESArcProgressView"></a>2.ESArcProgressView</h4><blockquote>
<p>传送门：<a href="https://github.com/e-sites/ESArcProgressView" target="_blank" rel="external">https://github.com/e-sites/ESArcProgressView</a>  </p>
</blockquote>
<h5 id="应用场景：-1"><a href="#应用场景：-1" class="headerlink" title="应用场景："></a>应用场景：</h5><p><img src="http://alithink.com/img/3bi/2.png" alt="Circle.png"></p>
<p>多层环形图（暂时这么称呼她吧）<br>其实是仿照的Apple Watch的Activity，不过确实比纯粹的柱状图更具美感一些^_^。</p>
<h5 id="优势：-1"><a href="#优势：-1" class="headerlink" title="优势："></a>优势：</h5><ul>
<li>其它的类似轮子还真没找到。。。</li>
<li>支持简单动画，不过需要手动处理下timer的runloop mode的问题。</li>
</ul>
<h4 id="3-XCL-Charts"><a href="#3-XCL-Charts" class="headerlink" title="3.XCL-Charts"></a>3.XCL-Charts</h4><blockquote>
<p>传送门：<a href="https://github.com/xcltapestry/XCL-Charts" target="_blank" rel="external">https://github.com/xcltapestry/XCL-Charts</a> </p>
</blockquote>
<h5 id="应用场景：-2"><a href="#应用场景：-2" class="headerlink" title="应用场景："></a>应用场景：</h5><p><img src="http://alithink.com/img/3bi/3.png" alt="android circle.png"></p>
<p>Android的多层环形图解决方案，XCL也是一个较为完备的Android图形库，不过相较来说库的成熟度没有Charts高，一些细节功能也存在一定程度的缺失。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>这里主要就Charts的问题解决方案进行一些分享：</p>
<h4 id="1-展示图形中的最后几个元素"><a href="#1-展示图形中的最后几个元素" class="headerlink" title="1. 展示图形中的最后几个元素"></a>1. 展示图形中的最后几个元素</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//显示可视区域的元素个数</span></div><div class="line">chartView?.setVisibleXRangeMaximum(<span class="number">6</span>)</div><div class="line">            </div><div class="line"><span class="comment">/*</span></div><div class="line"> * moveViewToX存在bug无法正确切换位置</div><div class="line"> * 调用此方法的前提条件是需要预先提供一个确定的frame</div><div class="line"> * xIndex为显示到的x元素的序列</div><div class="line"> */</div><div class="line">chartView?.moveViewToAnimated(xIndex: <span class="type">CGFloat</span>(xVals.<span class="built_in">count</span> - <span class="number">1</span>), yValue: <span class="number">0</span>, axis: <span class="type">ChartYAxis</span>.<span class="type">AxisDependency</span>.<span class="type">Left</span>, duration: <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>这里setVisibleXRangeMaximum设置的数目在grouped柱状图配置的时候记得要乘以单位组内柱子的数目并包含组之间间隔的空间（往往间隔的空间也算做一个柱子）。</p>
<h4 id="2-完整显示x轴所有的元素标签"><a href="#2-完整显示x轴所有的元素标签" class="headerlink" title="2. 完整显示x轴所有的元素标签"></a>2. 完整显示x轴所有的元素标签</h4><p>Charts默认自动计算相邻x轴元素标签的距离, 控制x轴部分标签的隐藏以达到较好的现实效果。但实际需求中往往会要求展示所有x轴的元素标签，那么就可以通过以下配置禁用默认的计算。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xAxis?.setLabelsToSkip(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<h4 id="3-设置为可拖动的图形与tableview的滑动存在冲突"><a href="#3-设置为可拖动的图形与tableview的滑动存在冲突" class="headerlink" title="3. 设置为可拖动的图形与tableview的滑动存在冲突"></a>3. 设置为可拖动的图形与tableview的滑动存在冲突</h4><p>暂时的解决办法是在可拖动的图形顶部覆盖一层隐藏层，需要看全局数据的用户需要先进行一步点击才能进行图形的拖动操作。</p>
<h3 id="存在的不足"><a href="#存在的不足" class="headerlink" title="存在的不足"></a>存在的不足</h3><h4 id="1-组合图包含grouped柱状图时存在bug"><a href="#1-组合图包含grouped柱状图时存在bug" class="headerlink" title="1. 组合图包含grouped柱状图时存在bug"></a>1. 组合图包含grouped柱状图时存在bug</h4><p><img src="http://alithink.com/img/3bi/4.png" alt="problem.png"><br><img src="http://alithink.com/img/3bi/5.png" alt="solution.png"><br>尚未解决，暂时只能将grouped柱状图跟线形图分开成两个图进行展示。。。<br>或者研究下liuxuan30的这个PR<br><a href="https://github.com/danielgindi/Charts/issues/1159#issuecomment-228954675" target="_blank" rel="external">issue传送门</a></p>
<h4 id="2-堆积图缺失线性堆积图"><a href="#2-堆积图缺失线性堆积图" class="headerlink" title="2. 堆积图缺失线性堆积图"></a>2. 堆积图缺失线性堆积图</h4><p>目前只提供柱状堆积图的支持。</p>
<h4 id="3-ChartMarker堆积图功能缺失"><a href="#3-ChartMarker堆积图功能缺失" class="headerlink" title="3. ChartMarker堆积图功能缺失"></a>3. ChartMarker堆积图功能缺失</h4><p>堆积图的ChartMarker目前只能展示堆积后的总值，而不能展示分项的值。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>目前的这套方案可以满足基本的数据可视化需求，对于一些较为复杂灵活的图形展示需求，也可以封装一个单独的web类型的卡片，对于这部分需求采用web相关的图形可视化解决方案进行处理。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/11/工作与生活的平衡/" itemprop="url">
                  工作与生活的平衡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-11T21:43:53+08:00" content="2016-06-11">
              2016-06-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/鸡汤乱炖/" itemprop="url" rel="index">
                    <span itemprop="name">鸡汤乱炖</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/11/工作与生活的平衡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/11/工作与生活的平衡/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对应视频的传送门：</p>
<p><a href="http://open.163.com/movie/2011/2/D/L/M77U1DAGR_M77U1L2DL.html" target="_blank" rel="external">如何实现工作与生活的平衡</a></p>
<h3 id="平衡的四个关键"><a href="#平衡的四个关键" class="headerlink" title="平衡的四个关键"></a>平衡的四个关键</h3><h4 id="1-有些职业的选择与生活具有不可调和性"><a href="#1-有些职业的选择与生活具有不可调和性" class="headerlink" title="1.有些职业的选择与生活具有不可调和性"></a>1.有些职业的选择与生活具有不可调和性</h4><p>这种不可调和跟周五允许不穿工装、育儿假等生活福利没有多大联系。很多人一直从事着自己痛恨着的工作，目的只是为了买一些没有多大用处的东西，以此博得自己的邻居朋友的羡慕而已。  </p>
<blockquote>
<p>职业的选择很重要，找到一份自己热爱并且可以驾驭掌控的工作是解决平衡问题的一个关键。</p>
</blockquote>
<h4 id="2-做平衡问题的掌舵者"><a href="#2-做平衡问题的掌舵者" class="headerlink" title="2.做平衡问题的掌舵者"></a>2.做平衡问题的掌舵者</h4><p>政府跟公司是无法帮你解决这个问题的，只能靠自己，自己不主动，最终的结果就不尽如意。所有商业公司其实本质上都是榨取你的价值以及尽可能的逃避责任，因此我们要尽可能的设定并加固自己生活中的各种界限，当工作的范畴越界时，主动的去解决与平衡。</p>
<blockquote>
<p>主动权在自己手中，理性的划分工作与生活的边界，才能为平衡提供依据。</p>
</blockquote>
<h4 id="3-合理控制理想平衡的时间周期"><a href="#3-合理控制理想平衡的时间周期" class="headerlink" title="3.合理控制理想平衡的时间周期"></a>3.合理控制理想平衡的时间周期</h4><p>这里慨叹下演讲者的身体素质（一天四次。。。），每个人对于理想中一天的定义不尽相同，但往往会发现其实这些想做的事情二十四小时的时间容量是不够的。有些人往往会想着等退休之后再好好享受生活，等孩子大了之后就可以有时间好好享受生活，其实这样就走入了另一个极端。一天太短，退休又太长，肯定会有折中的办法。</p>
<blockquote>
<p>有了好的规划，就要尽快实施，不要拖延，也不要安排的过于紧凑，制定一个合理的规划周期对于平衡来说也很重要。</p>
</blockquote>
<h4 id="4-平衡不只是工作之余健健身"><a href="#4-平衡不只是工作之余健健身" class="headerlink" title="4.平衡不只是工作之余健健身"></a>4.平衡不只是工作之余健健身</h4><p>很多人上班族，往往下班后以健身的方式来维持健康以及缓解压力，这本身是没问题的，但是只是健身其实还不够。很多人会说，我连健身的时间都没有，再让我去做其它事情就更不可能了。这里演讲者讲述了他与自己儿子的某一天的生活经历，大致是他提前下班去接儿子放学，然后带他在街边做了一些简单的户外游乐，然后带儿子去咖啡店吃了一些东西，最后回家给儿子洗澡给他讲故事陪他睡觉，等他吻过儿子的额头准备要离开儿子的房间时，儿子对他说：“爸爸，这是我过得最棒的一天”。</p>
<blockquote>
<p>小事并非无关紧要，在处理平衡问题时并不需要大张旗鼓的颠覆式的行动，也许多注意一些细节，多一些关心体贴与陪伴就够了。</p>
</blockquote>
<p>最后讲述者呼吁大家都能正确的处理平衡问题，这样也许会改变目前社会上单纯以个人财产衡量成功的观念。成功应该有一个更具平衡行和思想性的定义，即一个美好的生活的实现。</p>
<blockquote>
<p>共勉，为“美好生活“而努力。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/04/cocoapods私有仓库封装过程中的思考/" itemprop="url">
                  cocoapods私有仓库封装过程中的思考
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-04T21:33:11+08:00" content="2016-06-04">
              2016-06-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/04/cocoapods私有仓库封装过程中的思考/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/04/cocoapods私有仓库封装过程中的思考/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>背景：随着公司相关APP项目的开展，公用框架的创建与维护越发显得迫切起来。因为工作中经常接触使用cocoapods,也知道她其实可以搞定这件事，所以就首当其冲的选择了基于cocoapods的封装方案。</p>
</blockquote>
<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><ul>
<li>给工作中封装的组件一个沉淀的地方。</li>
<li>为新项目的开展提供高效的支撑。</li>
<li>框架代码单独维护，功能点升级更新快捷。</li>
<li>一定程度督促自己代码的组织与优化。</li>
</ul>
<h2 id="知识储备"><a href="#知识储备" class="headerlink" title="知识储备"></a>知识储备</h2><p>搭建的过程大致参考了这篇教程：<a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/" target="_blank" rel="external">使用Cocoapods创建私有podspec</a><br>教程非常的细致，很赞的分享。其中有几个地方可能会有点疑惑：</p>
<h3 id="Podfile中specs引入方式"><a href="#Podfile中specs引入方式" class="headerlink" title="Podfile中specs引入方式"></a>Podfile中specs引入方式</h3><h4 id="1-path-gt-的引入方式"><a href="#1-path-gt-的引入方式" class="headerlink" title="1. :path =&gt;的引入方式"></a>1. :path =&gt;的引入方式</h4><ul>
<li>会添加到Development Pods中，并且复制整个私有库的文件组织结构（文件夹嵌套关系都会保留）,这种引入方式非常适合于私有库的开发阶段，因为这种方式引入的其实就是实际私有库的源文件，在demo项目中通过这种方式引入，充分测试私有库的相关功能会非常方便快捷。</li>
<li>对强迫症患者来说可能会觉得有点不完美的地方，就是当specs中包含subspecs的时候，用这种方式引入时，会出现一些多余的文件层次嵌套。。。感兴趣的患者们可以去试一下。。。</li>
</ul>
<h4 id="2-常规的引入方式"><a href="#2-常规的引入方式" class="headerlink" title="2. 常规的引入方式"></a>2. 常规的引入方式</h4><p>常规的引入方式这里就不多说了，它走的是另一个极端，会剔除库中的文件组织结构，而简单的划分了源文件与资源文件，如果包含subspecs，只保留子模块名一级的文件层次，模块内部的文件结构将不复存在，这里暂时没有找到合适的解决办法保留原有组织结构。</p>
<p><img src="http://alithink.com/img/2cocoapods/1.png" alt="1.png"></p>
<p>比如上图的结构，发布之后将改变为：</p>
<p><img src="http://alithink.com/img/2cocoapods/2.png" alt="2.png"></p>
<h3 id="子模块划分思路"><a href="#子模块划分思路" class="headerlink" title="子模块划分思路"></a>子模块划分思路</h3><p>先说结果，大致是按照这个思路进行划分的：  </p>
<h4 id="1-网络（剔除具体API调用部分）"><a href="#1-网络（剔除具体API调用部分）" class="headerlink" title="1. 网络（剔除具体API调用部分）"></a>1. 网络（剔除具体API调用部分）</h4><ul>
<li>添加样例</li>
<li>包含常用插件（network状态标识等）</li>
<li>缓存</li>
</ul>
<h4 id="2-模型映射"><a href="#2-模型映射" class="headerlink" title="2. 模型映射"></a>2. 模型映射</h4><ul>
<li>统一API调用规则</li>
<li>封装公共响应处理逻辑</li>
<li>对于错误类型的统一处理</li>
</ul>
<h4 id="3-Hybrid"><a href="#3-Hybrid" class="headerlink" title="3. Hybrid"></a>3. Hybrid</h4><ul>
<li>资源的预加载（js, css等）</li>
<li>native能力开放</li>
</ul>
<h4 id="4-UI"><a href="#4-UI" class="headerlink" title="4. UI"></a>4. UI</h4><ul>
<li>HUD</li>
<li>Tab</li>
<li>侧边栏</li>
<li>Nav常用操作</li>
<li>下拉上拉</li>
<li>Autolayout封装</li>
<li>datasource封装</li>
<li>常用动画转场</li>
</ul>
<h4 id="5-安全"><a href="#5-安全" class="headerlink" title="5. 安全"></a>5. 安全</h4><ul>
<li>加密解密</li>
</ul>
<h4 id="6-统计"><a href="#6-统计" class="headerlink" title="6. 统计"></a>6. 统计</h4><ul>
<li>swizzling添加打点入口</li>
<li>日志记录模块封装</li>
<li>bug收集分析</li>
</ul>
<h4 id="7-动态性"><a href="#7-动态性" class="headerlink" title="7. 动态性"></a>7. 动态性</h4><ul>
<li>热部署方案</li>
</ul>
<p>主要基于目前涉及项目主要关注的部分进行了一些拆解，每个模块直接可能存在依赖关系，这块cocoapods也贴心的帮忙搞定了，例如:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">s.subspec <span class="string">'APIModule'</span> <span class="keyword">do</span> <span class="params">|ss|</span></div><div class="line">    ss.source_files = <span class="string">'Classes/APIModule/**/*.&#123;swift,h,m&#125;'</span></div><div class="line">    ss.dependency <span class="string">'Moya'</span>, <span class="string">'~&gt; 6.5.0'</span></div><div class="line">    ss.dependency <span class="string">'HanekeSwift'</span>, <span class="string">'~&gt; 0.10.1'</span></div><div class="line">    ss.dependency <span class="string">'NetworkActivityIndicator'</span>, <span class="string">'~&gt; 0.1.6'</span></div><div class="line">    ss.dependency <span class="string">'MonkeyKit/UtilModule'</span></div><div class="line">    ss.dependency <span class="string">'MonkeyKit/ModelMapperModule'</span></div><div class="line">    ss.dependency <span class="string">'MonkeyKit/SecurityModule'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>框架会根据将来的实际使用情况再进行优化调整，逐渐完善起来。  </p>
<h3 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h3><p>本轮主要是基于基础功能模块的拆分封装，其实对于APP群常用的业务模块也可以做相同的工作，比如登录验证模块或者逻辑的封装等。通过对于公用业务场景的思考，逐渐提炼出可以产品化的地方，然后塞入公用库，将大大提升相关APP群的开发效率与产品质量。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="AliThink" />
          <p class="site-author-name" itemprop="name">AliThink</p>
          <p class="site-description motion-element" itemprop="description">热爱生活，乐于分享，时而沉默寡言，时而嘻哈扯淡的两面派
</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/AliThink" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AliThink</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"alithinkblog"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
